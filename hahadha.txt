SELECT
  K.Pavadinimas,
  K.ISBN
FROM Stud.Knyga AS K
WHERE SUBSTRING(K.ISBN FROM 1 FOR 1) = SUBSTRING(K.ISBN FROM 4 FOR 1);


--2. Skaičius egzempliorių, kurie buvo gauti bibliotekoje praėjusį mėnesį ir jau buvo paimti skaityti.

SELECT
  COUNT(DISTINCT s.skaitytojas) AS skaitytoju_skaicius,
  COUNT(DISTINCT e.nr)          AS egzemplioriu_kiekis,
  COUNT(DISTINCT e.ISBN)          AS knygu_skaicius,
  COUNT(*) as egzemplioriu_ir_skaitytoju_skaicius

FROM Stud.Skaitymas AS s
JOIN Stud.Egzempliorius AS e ON e.nr = s.egzempliorius
WHERE s.paimta >= date_trunc('month', CURRENT_DATE) - INTERVAL '1 month'
  AND s.paimta IS NOT NULL;



SELECT tc.table_schema, tc.table_name, kc.column_name, tc.constraint_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kc
  ON kc.constraint_name = tc.constraint_name
  AND kc.table_schema = tc.table_schema
WHERE tc.constraint_type = 'PRIMARY KEY'
  AND tc.table_schema NOT IN ('pg_catalog','information_schema')
ORDER BY tc.table_schema, tc.table_name, kc.ordinal_position;

