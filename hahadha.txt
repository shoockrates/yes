SELECT
  K.Pavadinimas,
  K.ISBN
FROM Stud.Knyga AS K
WHERE SUBSTRING(K.ISBN FROM 1 FOR 1) = SUBSTRING(K.ISBN FROM 4 FOR 1);

WITH e_fix AS (
  SELECT e.Nr,
         e.ISBN,
         -- Pakeiskite 'Data' į konkretų pavadinimą, jei žinomas. Čia pervadinama į gavimo_data.
         e."Data" AS gavimo_data
  FROM Stud.Egzempliorius e
),
praejes_menuo AS (
  SELECT date_trunc('month', CURRENT_DATE) - INTERVAL '1 month' AS nuo,
         date_trunc('month', CURRENT_DATE) AS iki
)
SELECT COUNT(DISTINCT e_fix.Nr) AS kiekis
FROM e_fix
JOIN Stud.Skaitymas s ON s.Egzempliorius = e_fix.Nr
JOIN praejes_menuo pm ON e_fix.gavimo_data >= pm.nuo AND e_fix.gavimo_data < pm.iki;
